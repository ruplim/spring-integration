<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:sws="http://www.springframework.org/schema/web-services"
	xmlns:int-http="http://www.springframework.org/schema/integration/http"
	xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/web-services http://www.springframework.org/schema/web-services/web-services-2.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/integration/http http://www.springframework.org/schema/integration/http/spring-integration-http-4.3.xsd
		http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-4.3.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.3.xsd">

    <int:channel id="responseChannel"/>

    <!-- GET -->
	<int-http:inbound-gateway 
	    request-channel="httpGetChannel"
		reply-channel="responseChannel"
		supported-methods="GET"
		message-converters="converters"
		mapped-request-headers="HTTP_REQUEST_HEADERS"
		mapped-response-headers="HTTP_RESPONSE_HEADERS"
		path="/emps/{empId}"
		payload-expression="#pathVariables.empId">
		
		<int-http:request-mapping  consumes="application/json,application/xml"  produces="application/json, application/xml"/>
				
	    <int-http:header name="requestContextPath" 
	                   expression="T(org.springframework.web.context.request.RequestContextHolder).requestAttributes.request.contextPath"/>

      
	</int-http:inbound-gateway>
    <int:service-activator ref="empHttpService" method="get"  input-channel="httpGetChannel" output-channel="responseChannel"/>
    
    
    <!-- DELETE -->
    <int-http:inbound-channel-adapter
         channel="httpDeleteChannel"
         path="/emp/{empId}"
         supported-methods="DELETE"
         status-code-expression="T(org.springframework.http.HttpStatus).NO_CONTENT"
         payload-expression="#pathVariables.empId"/>
    
      <!-- POST -->
      <int-http:inbound-gateway
         request-channel="httpPostChannel"
         reply-channel="responseChannel"
         path="/emp"
         supported-methods="POST" 
         mapped-request-headers="*"  
         mapped-response-headers="*"
         message-converters="converters" 
         request-payload-type="com.samples.jaxb.Employee"/>
         
	
<!-- 	<int:router input-channel="httpChannel" expression="headers.http_requestMethod">
       <int:mapping value="GET"    channel="getRequest"/>
       <int:mapping value="DELETE" channel="deleteRequest"/>
    </int:router> -->



    <!-- Variant 1-->
	<int-http:inbound-gateway 
	    request-channel="httpVar1Channel"
		supported-methods="GET"
		message-converters="converters"
	    mapped-request-headers="*"
		path="/dept1/{deptId}/emp/{empId}"
		payload-expression="new com.samples.EmployeeDTO(#pathVariables.deptId, 
		                                                #pathVariables.empId,
		                                                #requestParams.getFirst('dependent'))">
		
	</int-http:inbound-gateway> 
	<!-- Variant One  -->
	<int:service-activator ref="empHttpService" method="getVar1"   input-channel="httpVar1Channel" />

    <!-- Variant 2-->
	<int-http:inbound-gateway 
	    request-channel="httpVar2Channel"
		supported-methods="POST"
		message-converters="converters"
	    mapped-request-headers="*"
	    request-payload-type="com.samples.jaxb.Employee"
		path="/dept2/{deptId}/emp/{empId}"
		payload-expression="new com.samples.EmployeeDTO(#pathVariables.deptId, 
		                                                #pathVariables.empId,
		                                                #requestParams.getFirst('dependent'),
		                                                T(org.springframework.web.context.request.RequestContextHolder).requestAttributes.request.contextPath
                                                        )">
                                                        
		
	</int-http:inbound-gateway> 
	<!-- Variant two  -->
	<int:service-activator ref="empHttpService" method="getVar2"   input-channel="httpVar2Channel" />
    
    
	
	
	<int:service-activator ref="empHttpService" method="delete" input-channel="httpDeleteChannel"/>
	
<!-- 	<int:chain input-channel="httpPostChannel">
	  <int:service-activator ref="empHttpService" method="post"/>
	  <int:header-enricher>
	    <int:header name="T(org.springframework.http.HttpHeaders).LOCATION" value="'http://localhost:8080/emp/' + payload.empId"/>
	  </int:header-enricher>
	</int:chain> -->
	
	
	<int:service-activator ref="empHttpService" method="post"   input-channel="httpPostChannel"   output-channel="responseChannel"/>
	
	
	
	<util:list id="converters">
	    <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter" />
	    <bean class="org.springframework.http.converter.xml.MarshallingHttpMessageConverter">
           <property name="marshaller"   ref="jaxbMarshaller" />
           <property name="unmarshaller" ref="jaxbMarshaller" />
        </bean> 
        
	</util:list>
	
    <bean id="empHttpService" class="com.samples.EmpService">
      <property name="empDao">
           <bean class="com.samples.EmpDao"/>
      </property>
    </bean>
     
     <bean  id="jaxbMarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPath" value="com.samples.jaxb"/>
     </bean>  

</beans>